<% content_for :sidebar do %>
  <%= partial "misc/personal_sidebar" %>
<% end %>

<h1><%= I18n.t("settings.avatar_settings") %></h1>

<% unless @settings.errors.empty? %>
<div class="flash alert">
  <p><%= I18n.t("general.errors_occured") %></p>
  <ul>
    <% @settings.errors.messages.each do |key, msg| %>
      <li><%= key %>: <%= msg %></li>
    <% end %>
  </ul>
</div>
<% end %>

<% form_for @settings, url(:settings, :avatar), :method => :patch, :class => "settings-form" do |f| %>
  <div class="setting">
    <div class="header settings-header">
      <%= f.label :use_gravatar %>
    </div>

    <div class="settings-desc">
      <%= I18n.t("settings.descriptions.gravatar") %>
    </div>

    <div class="settings-content">
      <%= f.label :use_gravatar %><%= f.check_box :use_gravatar %>
    </div>

    <%# Do not make a request to Gravatar when the user has
      # not enabled it! Privacy concerns apply. %>
    <% if @settings.use_gravatar %>
      <%= image_tag @settings.gravatar, :alt => "User Gravatar" %>
    <% end %>
  </div>

  <div class="setting">
    <div class="header settings-header">
      <label><%= I18n.t("settings.avatar") %></label>
    </div>

    <div class="settings-desc">
      <%= I18n.t("settings.descriptions.avatar") %>
    </div>

    <div class="settings-content">
      <%= f.file_field :avatar %>
    </div>

    <%# User may have not uploaded an avatar yet, then we would get
      # nil %>
    <% if @settings.normal_avatar %>
      <%= image_tag @settings.normal_avatar, :alt => "User avatar" %>
    <% end %>

    <p class="submit-separator">
      <%= f.submit I18n.t("general.update"), :class => "button-ok" %>
      <%= link_to I18n.t("general.delete"), url(:settings, :avatar) + "?authenticity_token=#{session[:csrf]}", :method => :delete, :class => "button-error" %>
    </p>
  </div>
<% end %>

<?xml version="1.0" encoding="UTF-8"?>
<% if request.ssl?
     protocol = "https"
   else
     protocol = "http"
   end
%>
<feed xmlns="http://www.w3.org/2005/Atom">
  <link rel="self" type="application/atom+xml" href="<%= protocol %>://<%= Chessboard.config.domain + url(:topics, :feed) %>"/>
  <link rel="alternate" type="text/html" href="<%= protocol %>://<%= Chessboard.config.domain %>"/>
  <title><%= Chessboard.config.title %></title>
  <subtitle><%= Chessboard.config.subtitle %></subtitle>
  <updated><%= @posts.first.updated_at.iso8601 %></updated>
  <id><%= protocol %>://<%= Chessboard.config.domain %>/</id>
  <% @posts.each do |post| %>
    <entry>
      <title><%= post.topic.title %></title>
      <link href="<%= protocol %>://<%= Chessboard.config.domain + post_url(post) %>"/>
      <id><%= protocol %>://<%= Chessboard.config.domain + post_url(post) %></id>
      <published><%= post.created_at.iso8601 %></published>
      <updated><%= post.updated_at.iso8601 %></updated>
      <author><name><%= post.author.nickname %></name></author>
      <content type="html">
	<%= h(process_markup(post.content, post.markup_language)) %>
      </content>
    </entry>
  <% end %>
</feed>

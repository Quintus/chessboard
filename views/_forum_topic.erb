<%
  if logged_in?
    user = logged_in_user
  #is_read = user.read?(forum_topic)
  is_read = false

    #if forum_topic.announcement? && !is_read
    #  extra_class = "topic-announcement topic-unread"
    #  image = "icons/topic_announcement_unread.png"
    #elsif forum_topic.announcement?
    #  extra_class = "topic-announcement topic-read"
    #  image = "icons/topic_announcement_read.png"
    #elsif forum_topic.sticky? && !is_read
    #  extra_class = "topic-sticky topic-unread"
    #  image = "icons/topic_sticky_unread.png"
    #elsif forum_topic.sticky?
    #  extra_class = "topic-sticky topic-read"
    #  image = "icons/topic_sticky_read.png"
    #elsif forum_topic.locked?
    #  extra_class = "topic-locked"
    #  image = "icons/topic_normal_locked.png"
    #elsif !is_read
    #  extra_class = "topic-unread"
    #  image = "icons/topic_normal_unread.png"
    #else
    #  extra_class = "topic-read"
    #  image = "icons/topic_normal_read.png"
      #end
  extra_class = "topic-read"
      image = "/images/icons/topic_normal_read.png"
  else
    #if forum_topic.announcement?
    #  extra_class = "topic-announcement topic-read"
    #  image = "icons/topic_announcement_read.png"
    #elsif forum_topic.sticky?
    #  extra_clsas = "topic-sticky topic-read"
    #  image = "icons/topic_sticky_read.png"
    #elsif forum_topic.locked?
    #  extra_class = "topic-locked"
    #  image = "icons/topic_normal_locked.png"
    #else
    #  extra_class = "topic-read"
    #  image = "icons/topic_normal_read.png"
#end
  extra_class = "topic-read"
      image = "/images/icons/topic_normal_read.png"
  end

    threadurl = "/forums/#{@forum[:id]}/threads/#{thread_starter.id}"
  if defined?(urlquerystr)
    threadurl += "?#{urlquerystr}"
  end
%>
<tr class="forum-topic <%= extra_class %>">
  <td class="list-icon imgcell">
    <img src="<%= image %>" alt="Icon"/>
  </td>
  <td class="list-topic">
    <a href="<%= threadurl %>"><%= thread_starter.pretty_title %></a><br/>
    <%= t.forums.author_by %> <a href="/users/<%= thread_starter.author.id %>"><%= thread_starter.author.display_name %></a>

    <%# total_pages = (forum_topic.posts.count.to_f / GlobalConfiguration.instance.page_post_num.to_f).ceil %>
    <% total_pages = 1 %>
    <% if total_pages > 1 %>
      | <%= I18n.t("topics.pages") %>
      <ul class="topic-pages topic-pages-forum">
	<%# partial "topics/topic_pages", :locals => {:topic => forum_topic, :total_pages => total_pages} %>
      </ul>
    <% end %>
  </td>
  <% all_replies = thread_starter.recursive_replies.sort{|a, b| b.created_at <=> a.created_at} %>
  <td class="list-replies numbercell"><%= all_replies.count %></td>
  <td class="list-views numbercell"><%= thread_starter.views %></td>
  <td class="forumlastpost">
    <%= l (all_replies.first || thread_starter).created_at %><br/>
    <%= t.forums.author_by %> <a href="/users/<%= thread_starter.author.id %>"><%= thread_starter.author.display_name %></a>
  </td>
</tr>
